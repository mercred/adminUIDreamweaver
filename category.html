<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Category View</title>    
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="css/custom.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
		
  </head>
  <body onLoad="loadCategories()">
  <div id="mask"></div>
  <div id="popup">    
    Uploading, please wait...    
  </div>
  <div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">   
	<div class="modal-header">
			<span class="close">&times;</span>
			<h2>Background material preview</h2>
		  </div>
		  <div class="modal-body" id="modalBodyID">
			
			
		  </div>
		  <div class="modal-footer">			
		  </div>
  </div>

</div>
 	<div class="container" id="overlay" style="width: 90%;">
      <header class="row">
        <div class="col-lg-12">
          <h1>Admin Firebase UI</h1>
        </div>
      </header>
      <div class="row">
        <div class="col-lg-12">
          <ul class="nav nav-tabs">
            <li role="presentation"><a href="category.html">Select category</a></li>
            <li role="presentation"><a href="question.html">Find question</a></li>
          </ul>
        </div>
      </div>
      <div class="row">
    <div class="col-lg-12">
      <div class="row" style="width: 100%">
      <div class="col-lg-3" id="categories">
         <div class="row">
            <div class="col-lg-12">
              <label for="textfield2">Enter name:</label>
              <input type="text" name="textfield2" id="categoryName">            	
            </div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <button type="button" class="btn btn-default" onClick="createEmptyCategory()"> Create new category    
              </button>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-12">
            <label>List of Categories:</label>
            	<ul class="nav nav-pills nav-stacked" style="border: 2px solid black" id="categories_list">
          </ul> 
            </div>
          </div>
         
                   
        </div><!-- categoryList-->
      <div class="col-lg-5" id="mainContainer" style="visibility: hidden">
             <div class="row" style="border: 1px solid black">
               <div class="col-lg-8">
                 <h3 id="name">Category Name:</h3>
                 <h5 id="nQuestions">Number of questions:</h5>
               </div>
               <div class="col-lg-4">                 
                 <div class="btn-group-vertical" style="width: 100%" role="group" aria-label="Vertical button group">
                   <button type="button" class="btn btn-danger"  onClick="deleteCurrentCategory()">Delete category</button>                
                   <a href="#" id="displayQuestionsButton" class="btn btn-primary">Questions</a>       
                   <button type="button" id="myBtn" style="width: 100%">Show preview</button>                         
                 </div>
               </div>
             </div>
             <div class="row" style="border: 1px solid black">
               <div class="col-lg-12">
				   <div class="row">
				   <div class="col-lg-12">
					 <label for="textarea">Background Material:</label>
					 <textarea name="textarea" id="textarea" style="width:100%;resize: none;height: 50vh"></textarea>             
					</div>
				  </div>
               <div class="row">
              <div class="col-lg-4">                
               </div>
               <div class="col-lg-4">
                 <button type="button" class="btn btn-success" onClick="saveBMChanges()">Save changes</button>
               </div>
               <div class="col-lg-4">
                 <button type="button" class="btn btn-danger" onClick="discardBMChanges()">Discard changes</button>
               </div>
             </div>
               </div>
               <div>
             
             
           </div><!-- options and text -->           
      </div>
      </div><!-- main-->
      <div class="col-lg-4" style="visibility: hidden" id="imagesContainer">
            <div class="row">
              <div class="col-lg-6">
              	<input type="file" multiple onchange="uploadImagesBG(this.files)" id="inputFile" accept=".png" style="display: none"> 
              	<input type="button" style="width: 100%" class="btn btn-default" value="Upload" onclick="document.getElementById('inputFile').click();" />             	
              </div>
              <div class="col-lg-6">
              	<button type="button" onClick="deleteCurrentImageBG()" id="deleteBGImageButton" class="btn btn-default">Delete Current Image</button>              	
              </div>
            </div>
            <div class="row">
              <div class="col-lg-12" ><img id="bgImageId" src="images/ImgResponsive_Placeholder.png" class="img-responsive" alt="Placeholder image"></div>         
            </div>
              <div class="row">
                <div class="col-lg-12">
                 <label>List of Images:</label>
                	<ul class="nav nav-pills nav-stacked" style="border: 2px solid black;" id="bg_images_list"></ul>           
                </div>
              </div> 
          </div><!-- images--> 
      </div>
	</div>
	</div>
	</div><!-- container end --> 	

	<!-- Javascript files --> 
	<script src="js/jquery-1.11.3.min.js"></script>
	<script src="js/bootstrap.js"></script>	
	
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"> </script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-app.js"> </script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-database.js"> </script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-storage.js"> </script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-auth.js"> </script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"> </script>	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
	<script src="js/imageUpload.js"></script>
	<script src="js/category.js"></script>
	<script> 
	 

		var modal = document.getElementById('myModal');
		// Get the button that opens the modal
		var btn = document.getElementById("myBtn");
		// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
		// When the user clicks on the button, open the modal
		
		btn.onclick = function() {
			btn.style.display="hidden";
			modal.style.display = "block";
			var myNode = document.getElementById("modalBodyID");
		while (myNode.firstChild) {
			myNode.removeChild(myNode.firstChild);
		}
			parseComplexText(currentCategoryBGText,"modalBodyID");			
		 }
		span.onclick = function() {
        modal.style.display = "none";
		btn.style.display="visible";
}

		// When the user clicks anywhere outside of the modal, close it
		/*
		window.onclick = function(event) {
			console.log("Target is:"+event.target);
			if (event.target != modal) {
				modal.style.display = "none";
			}
		} 
	  */
	  
	  
	  function parseComplexText(text,parentID){
	
		var res;
		var pattern =new RegExp("img\\d+.*");
		var mainString="";
	    var splitString=text.split(" ");
		for (i = 0; i < splitString.length; i++) {
			res=pattern.exec(splitString[i]);
			if(res!=null&&res!=undefined){
				//add div with current text
				if(mainString!=""&&mainString!=null){
					insertText(mainString,parentID);					
					mainString="";
				}
				//insert image	
				var imgName=bgImageList[splitString[i]];				
				//get URL from name				
				insertImage(imgName,parentID );
				}else{
					mainString+=" "+splitString[i];
				}		
		}
		if(mainString!=""&&mainString!=null){
			
			insertText(mainString,parentID);
		}
		renderMathInElement(document.getElementById(parentID));				
	}
	
	
	
	function insertText(text,parentElementID){
		var rowDiv = document.createElement("div");
		rowDiv.className="row";
		var colDiv=document.createElement("div");
		colDiv.className="col-lg-12";
		colDiv.innerHTML=text;		
		rowDiv.appendChild(colDiv);	
		document.getElementById(parentElementID).appendChild(rowDiv);		
	}
	
	function insertImage(imageURL,parentElementID){
		var rowDiv = document.createElement("div");
		rowDiv.className="row";
		var colDiv=document.createElement("div");
		rowDiv.className="col-lg-12";
		
		var image = document.createElement("img");
		image.id=imageURL+"render";
		image.className="img-responsive";
		image.alt="Placeholder image";		
		colDiv.appendChild(image);	
		rowDiv.appendChild(colDiv);	
		document.getElementById(parentElementID).appendChild(rowDiv);
		downloadAndDisplayImageDirectly(imageURL,image.id)
		
	}	
		 </script>
	
  </body>
</html>