<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Main Page</title>
    <!-- Bootstrap -->
	<link href="css/bootstrap.css" rel="stylesheet">
	  <link href="css/custom.css" rel="stylesheet">
	<link href="css/bootstrap-3.3.7.css" rel="stylesheet" type="text/css">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
  </head>
  <body onLoad="initializeApp()">
	<div class="container-fluid">
      <header class="row">
        <div class="col-lg-12">
          <h1>Admin Firebase UI</h1>
        </div>
      </header>
		
		
		
		
		
		
		<div class="row" id="loginMenuID" style="display: block; visibility: hidden">
		 <div class="col-lg-12">
      <div class="row">
        <div class="col-lg-12">
        	
        	<input id="userEmail" type="text" placeholder="Email...">
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
        
        	<input id="userPassword" type="password" placeholder="Password...">
        	
        </div>
      </div>
			 <div class="row">
	   <div class="col-lg-12" id="inputErrors">      
        	       </div> 	
        </div>
      <div class="row">
        <div class="col-lg-3">
         	
              <button type="button" class="btn btn-default" onClick="Login()"> Login    
              </button>
        </div>        
      </div>
    </div>
			</div>
		

		
      <div class="row menuColor" id="mainMenuID" style="visibility: hidden;">
        <div class="col-lg-5">
          <ul class="nav nav-tabs">
            <li role="presentation"><a href="category.html">Select category</a></li>
            <li role="presentation"><a href="question.html">Find question</a></li>
          </ul>
        </div>
		  <div class="col-lg-7"></div>
		   <div class="text-right">
         	 <div id="currentUser"></div>
              <button type="button" id="logoutButtonID" class="btn btn-default" onClick="Logout()"> Logout    
              </button>
			</div>
        </div>
		  <div class="row">
    <div class="col-lg-12"> Iframe placeholder
      </div>
	</div>
      </div>
      
	
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
	<script src="js/jquery-1.11.3.min.js"></script>

	<!-- Include all compiled plugins (below), or include individual files as needed --> 
	<script src="js/bootstrap.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"> </script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-app.js"> </script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-database.js"> </script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-storage.js"> </script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-auth.js"> </script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"> </script>
	<script src="js/validate.min.js"></script>
	<script>
		function initializeApp(){
			var config = {
			  apiKey: "AIzaSyCwYIYau4w3LKZ4EuKZPdBIfbdmg1JsWvQ", 	   
			  databaseURL: "https://studymechanics.firebaseio.com",
			  storageBucket: "studymechanics.appspot.com",
			  authDomain: "studymechanics.firebaseapp.com",
		  };
		  firebase.initializeApp(config);
		  
			//changes when we either logIn or logOut
		  firebase.auth().onAuthStateChanged(function(user) {
			  if(user==null){
				  //we have been signed out
				  console.log("Signed out");
				  document.getElementById("loginMenuID").style.display="initial";
				  document.getElementById("loginMenuID").style.visibility="visible";//change both visibility and display because otherwise we can see login menu for split second after change.
				   document.getElementById("mainMenuID").style.visibility="hidden";
				  		
			  }
			  else{
				  document.getElementById("userPassword").value="";
		           document.getElementById("userEmail").value="";				   
		           window.user = user;
				   $("#currentUser").html("User: "+user.email);
				  document.getElementById("loginMenuID").style.display="none";
				  document.getElementById("mainMenuID").style.visibility="hidden";
				 document.getElementById("mainMenuID").style.visibility="visible";			  
			  }
			 
		  });			
			
		}
		
		
		
		
	  function Logout(){
		firebase.auth().signOut()
		 .catch(function (err) {
		   // Handle errors
		 });			
			
		}
	  function Login(){ 
		   $('#inputErrors').html("");
		  var password=document.getElementById("userPassword").value;		  
		  var email= document.getElementById("userEmail").value;
		  
		  var passwordValidation = validate.single(password, {presence: true});
		  
		  var emailValidation = validate.single(email, {presence: true, email: true});
		 if(emailValidation!=undefined){			
			  $('#inputErrors').html("Email "+emailValidation[0]);
			   return;
		  }  
		  if(passwordValidation!=undefined){
			  $('#inputErrors').html("Password "+passwordValidation[0]);
			  password="";
			  return;
		  }
		  
		  
		  firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {			  
			    $('#inputErrors').html(error.message);			  
			});		  
	  }
	  </script>
  </body>
</html>