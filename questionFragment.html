<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Untitled Document</title>
    <!-- Bootstrap -->
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="css/bootstrap-3.3.7.css" rel="stylesheet" type="text/css">
	<link href="css/custom.css" rel="stylesheet">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
  </head>
  <body onLoad="displayQuestion()">
<div class="container-fluid" id="mainContainer">
  <div class="row" style="border: 2px solid black">
    <div class="col-lg-8" >
    <div class="row"><textarea id="qTxtID" style="width:100%;resize: none;"></textarea></div>
    <div class="row">
    	<button type="button" class="btn btn-default" style="width: 100%">Save</button> 
    </div>   
    		
    </div>
    <div class="col-lg-4">
      <div class="row">
        <div class="col-lg-6">
        	 <button type="button" class="btn btn-default" style="width: 100%">Upload</button> 
        </div>
        <div class="col-lg-6">
        	 <button type="button"  class="btn btn-default" style="width: 100%">Delete Current Image</button>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12"><img src="images/ImgResponsive_Placeholder.png" class="img-responsive" alt="Placeholder image" id="qImgID"></div>
      </div>
    </div>
  </div>
</div>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
	<script src="js/jquery-1.11.3.min.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>  
<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-database.js"></script>
 <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-storage.js"></script>
 <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

 <script src="js/utility.js"></script>
 <script src="js/imageUpload.js"></script>

 <script>
	 // <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"> 
 
  var config = {
      apiKey: "AIzaSyCwYIYau4w3LKZ4EuKZPdBIfbdmg1JsWvQ", 	   
      databaseURL: "https://studymechanics.firebaseio.com" ,	  
	  storageBucket: "studymechanics.appspot.com"
  };
	
	firebase.initializeApp(config);
	 var category;
	 var question;
	 var answerToImage={};
	 
	 function generateCreateButton(containerID){
		 
		 
	 }
	 
	 
	 
	 function deleteAnswerImage(answerName){		
		 
		 
		 
		 
		 
		 
		 var desertRef = firebase.storage().ref(answerToImage[answerName]);

      // Delete the file
      desertRef.delete().then(function() {
		 firebase.database().ref('questions').child(category).child('questions').child(question).child('answers').child(answerName).child('img').set(null);
		  
      }).catch(function(error) {
        alert("Error occured during file deletion: "+ error);
      }); 
		 
	 }
	 
	 
	 function generateAnswerClean(ansUniqName,text,imageName,isCorrect,containerID){
		var rowDiv = document.createElement("div");	rowDiv.className="row"; rowDiv.style.border="2px solid black";
		var colDiv1=document.createElement("div");	colDiv1.className="col-lg-7";
		var colDiv2=document.createElement("div");	colDiv2.className="col-lg-4";
		var colDiv3=document.createElement("div");	colDiv3.className="col-lg-1";
		 
		var rowDiv11 = document.createElement("div"); rowDiv11.className="row";rowDiv11.style.backgroundColor="black";
		 var textArea = document.createElement("textarea");	textArea.style.resize="none";
		 textArea.style.width="100%";
		 textArea.value="ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus";
		 rowDiv11.appendChild(textArea);
		 colDiv1.appendChild(rowDiv11);
		 
		 var rowDiv12 = document.createElement("div"); rowDiv12.className="row";rowDiv11.style.backgroundColor="orange";
		 var saveButton = document.createElement("button");
		 saveButton.className ="btn btn-default";
		 saveButton.style.width="100%";
		 saveButton.innerHTML="Save";
		 rowDiv12.appendChild(saveButton);		 
		 colDiv1.appendChild(rowDiv12);
		 
		 rowDiv.appendChild(colDiv1);
		 
		 
		 var rowDiv21 = document.createElement("div"); rowDiv21.className="row";
		
		 
		 var colDivUpload=document.createElement("div");colDivUpload.className="col-lg-6";
		 colDivUpload.style.backgroundColor="yellow";
		 var UploadButton = document.createElement("button");
		 UploadButton.className="btn btn-default";
		 UploadButton.style.width="100%";
		 UploadButton.innerHTML="Upload";
		 colDivUpload.appendChild(UploadButton);
		 rowDiv21.appendChild(colDivUpload);
		 
		 
		 
		 var colDivDelete=document.createElement("div");	colDivDelete.className="col-lg-6";
		 colDivDelete.style.backgroundColor="orange";
		 var DeleteButton = document.createElement("button");
		 DeleteButton.className="btn btn-default";
		 DeleteButton.style.width="100%";
		 DeleteButton.innerHTML="Delete Current Image";
		 colDivDelete.appendChild(DeleteButton);
		 rowDiv21.appendChild(colDivDelete);		 
		 colDiv2.appendChild(rowDiv21);
		 
		 
		 var rowDiv22 = document.createElement("div"); rowDiv22.className="row";
		 rowDiv22.style.backgroundColor="red";	
		 var colDivImage=document.createElement("div");	colDivImage.className="col-lg-12";
		  var mainImage = document.createElement("img");
		 mainImage.src="images/ImgResponsive_Placeholder.png";
		 mainImage.className="img-responsive";
		 colDivImage.appendChild(mainImage);
		 rowDiv22.appendChild(colDivImage);
		 colDiv2.appendChild(rowDiv22);		 
		rowDiv.appendChild(colDiv2);
		 
		 
		rowDiv.appendChild(colDiv3);
		document.getElementById(containerID).appendChild(rowDiv);
		 
	 }
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
	function generateAnswer(ansUniqName,text,imageName,isCorrect,containerID){
		
		var rowDiv = document.createElement("div");	rowDiv.className="row";
		var colDiv1=document.createElement("div");	colDiv1.className="col-lg-6";
		var colDiv2=document.createElement("div");	colDiv2.className="col-lg-5";
		var colDiv3=document.createElement("div");	colDiv2.className="col-lg-1";
		
		var inputText=document.createElement("textarea");
			inputText.setAttribute("id",ansUniqName+"text");
			inputText.value=text;
		    inputText.style.resize="none";
		    inputText.style.width="100%";		    
		colDiv1.appendChild(inputText);
		var saveTxtButton=document.createElement("button");
			saveTxtButton.class="btn btn-default";
			saveTxtButton.innerHTML="Save";
			saveTxtButton.type="button";
			saveTxtButton.addEventListener('click', (function(UniqName) {
			return function() {
					saveAnswerText(UniqName);
				}
		})(ansUniqName));	
		colDiv1.appendChild(saveTxtButton);
		
		
		var rowDiv41 = document.createElement("div");	rowDiv41.className="row"; 
		//add 2 columns and 2 buttons to rowDiv41
		
		
		/*<input type="file" multiple onchange="uploadImagesBG(this.files)" id="inputFile" accept=".png" style="display: none"> 
              	<input type="button" style="width: 100%" class="btn btn-default" value="Upload" onclick="document.getElementById('inputFile').click();" /> */ 
		
		
		var colDiv411=document.createElement("div");	colDiv411.className="col-lg-6";
		var uploadDialog=document.createElement("input");
		uploadDialog.type="file";
		uploadDialog.setAttribute("accept",".png");
		//uploadDialog.style.display="none";			
		uploadDialog.addEventListener('change', (function(UniqName) {
			return function() {
					var file=uploadDialog.files[0];
				//change answerToImage
					console.log(file);
					console.log(UniqName);
				}
		})(ansUniqName));
		colDiv411.appendChild(uploadDialog);
		
	   var colDiv412=document.createElement("div");	colDiv412.className="col-lg-6";
	   var deleteButton=document.createElement("button");
		saveTxtButton.class="btn btn-default";
		saveTxtButton.innerHTML="Delete Current Image";
		saveTxtButton.type="button";
		saveTxtButton.addEventListener('click', (function(UniqName) {
		return function() {
				deleteAnswerImage(UniqName);
			    document.getElementById(ansUniqName+"image").src="images/ImgResponsive_Placeholder.png";
			
				}
		})(ansUniqName));	
		colDiv412.appendChild(deleteButton);
		
		rowDiv41.appendChild(colDiv411);
		rowDiv41.appendChild(colDiv412);
		
		var rowDiv42 = document.createElement("div");	rowDiv42.className="row"; 
			//add image to rowDiv42
		
		 var colDiv421=document.createElement("div");	colDiv421.className="col-lg-12";
		
			var image = document.createElement("img");
				image.id=ansUniqName+"image"; 
				image.className="img-responsive"; 
				image.alt="Placeholder image";
			colDiv421.appendChild(image);
		rowDiv42.appendChild(colDiv421);
		colDiv2.appendChild(rowDiv41);
		colDiv2.appendChild(rowDiv42);
		
		/*
		<div class="row">
              <div class="col-lg-12" ><img id="bgImageId" src="images/ImgResponsive_Placeholder.png" class="img-responsive" alt="Placeholder image"></div>         
            </div>
		*/
		
		var rowIsCorrect=document.createElement("div");	rowIsCorrect.className="row";
		var colIsCorrect=document.createElement("div");	colIsCorrect.className="col-lg-12";	
		//radio button goes here
		var image2 = document.createElement("img");
			image2.className="img-responsive"; 
			image2.alt="Placeholder image";
			image2.src="images/ImgResponsive_Placeholder.png";		
		colIsCorrect.appendChild(image2);
		rowIsCorrect.appendChild(colIsCorrect);		
		colDiv3.appendChild(rowIsCorrect);
		
		
		rowDiv.appendChild(colDiv1);
		rowDiv.appendChild(colDiv2);
		rowDiv.appendChild(colDiv3);
		document.getElementById(containerID).appendChild(rowDiv);
		downloadAndDisplayImageDirectly(imageName,ansUniqName+"image");
	 }
	 
	 function saveAnswerText(UniqName){
		  var answerText = document.getElementById(UniqName+"text").value;		  firebase.database().ref('questions').child(category).child('questions').child(question).child('answers').child(UniqName).child('text').set(answerText);	 
	 }
	 
	function displayQuestion(){
		category=getParameter(window.location.href ,"category");
	    question=getParameter(window.location.href ,"question"); 	
		var oneQuestionQuery= firebase.database().ref("questions").child(category).child("questions").child(question).orderByKey();
  oneQuestionQuery.once("value").then(
        function(snapshot) {   	  
			var snapObj=snapshot.val();			
			
			$( "#qTxtID" ).text("Category:"+category+", question:"+question+".\n"+snapObj.text);
			downloadAndDisplayImageDirectly(snapObj.img,"qImgID");
						//TODO: add event listeners
			
			var containerID="mainContainer";
			var answers=snapObj.answers;		
			for (var key in answers) {
				// skip loop if the property is from prototype
				if (!answers.hasOwnProperty(key)) continue;

				var obj = answers[key];
				var properties={};
				for (var prop in obj) {
					// skip loop if the property is from prototype
					if(!obj.hasOwnProperty(prop)) continue;

					//properties are in order: img,isCorrect, text					
					properties[prop]=obj[prop];
				}
				console.log(containerID);
				answerToImage[key]=properties["img"];
				generateAnswerClean(key,properties["text"],properties["img"],properties["isCorrect"],containerID);
				return;
			}
			generateCreateButton(containerID);
		}
			
    );//end of oneQuestionQuery.once("value").then 
	 }//end of function displayQuestion()
	  
	  </script> 
	<!-- Include all compiled plugins (below), or include individual files as needed --> 
  <script src="js/bootstrap.js"></script>
  </body>
</html>